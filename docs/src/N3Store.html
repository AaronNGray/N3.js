<!DOCTYPE html>

<html>
<head>
  <title>N3Store.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="IRIs.html">
                  src/IRIs.js
                </a>
              
                
                <a class="source" href="N3DataFactory.html">
                  src/N3DataFactory.js
                </a>
              
                
                <a class="source" href="N3Lexer.html">
                  src/N3Lexer.js
                </a>
              
                
                <a class="source" href="N3Parser.html">
                  src/N3Parser.js
                </a>
              
                
                <a class="source" href="N3Store.html">
                  src/N3Store.js
                </a>
              
                
                <a class="source" href="N3StreamParser.html">
                  src/N3StreamParser.js
                </a>
              
                
                <a class="source" href="N3StreamWriter.html">
                  src/N3StreamWriter.js
                </a>
              
                
                <a class="source" href="N3Util.html">
                  src/N3Util.js
                </a>
              
                
                <a class="source" href="N3Writer.html">
                  src/N3Writer.js
                </a>
              
                
                <a class="source" href="index.html">
                  src/index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>N3Store.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><strong>N3Store</strong> objects store N3 quads by graph in memory.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> N3DataFactory, termToId, termFromId } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./N3DataFactory&#x27;</span>;
<span class="hljs-keyword">import</span> { Readable } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;readable-stream&#x27;</span>;
<span class="hljs-keyword">import</span> namespaces <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./IRIs&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="constructor">Constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">N3Store</span> </span>{
  <span class="hljs-keyword">constructor</span>(quads, options) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The number of quads is initially zero</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._size = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><code>_graphs</code> contains subject, predicate, and object indexes per graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._graphs = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><code>_ids</code> maps entities such as <code>http://xmlns.com/foaf/0.1/name</code> to numbers,
saving memory by using only numbers as keys in <code>_graphs</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._id = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">this</span>._ids = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
    <span class="hljs-built_in">this</span>._ids[<span class="hljs-string">&#x27;&gt;&lt;&#x27;</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// dummy entry, so the first actual key is non-zero</span>
    <span class="hljs-built_in">this</span>._entities = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>); <span class="hljs-comment">// inverse of `_ids`</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><code>_blankNodeIndex</code> is the index of the last automatically named blank node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._blankNodeIndex = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Shift parameters if <code>quads</code> is not given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!options &amp;&amp; quads &amp;&amp; !quads[<span class="hljs-number">0</span>])
      options = quads, quads = <span class="hljs-literal">null</span>;
    options = options || {};
    <span class="hljs-built_in">this</span>._factory = options.factory || N3DataFactory;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Add quads if passed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (quads)
      <span class="hljs-built_in">this</span>.addQuads(quads);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="public-properties">Public properties</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="size-returns-the-number-of-quads-in-the-store"><code>size</code> returns the number of quads in the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">get</span> <span class="hljs-title">size</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return the quad count if if was cached</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> size = <span class="hljs-built_in">this</span>._size;
    <span class="hljs-keyword">if</span> (size !== <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> size;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Calculate the number of quads by counting to the deepest level</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    size = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> graphs = <span class="hljs-built_in">this</span>._graphs, subjects, subject;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> graphKey <span class="hljs-keyword">in</span> graphs)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> subjectKey <span class="hljs-keyword">in</span> (subjects = graphs[graphKey].subjects))
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> predicateKey <span class="hljs-keyword">in</span> (subject = subjects[subjectKey]))
          size += <span class="hljs-built_in">Object</span>.keys(subject[predicateKey]).length;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._size = size;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="private-methods">Private methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="_addtoindex-adds-a-quad-to-a-three-layered-index"><code>_addToIndex</code> adds a quad to a three-layered index.</h3>
<p>Returns if the index has changed, if the entry did not already exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _addToIndex(index0, key0, key1, key2) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Create layers as necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> index1 = index0[key0] || (index0[key0] = {});
    <span class="hljs-keyword">var</span> index2 = index1[key1] || (index1[key1] = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Setting the key to <em>any</em> value signals the presence of the quad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> existed = key2 <span class="hljs-keyword">in</span> index2;
    <span class="hljs-keyword">if</span> (!existed)
      index2[key2] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> !existed;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="_removefromindex-removes-a-quad-from-a-three-layered-index"><code>_removeFromIndex</code> removes a quad from a three-layered index</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _removeFromIndex(index0, key0, key1, key2) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Remove the quad from the index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> index1 = index0[key0], index2 = index1[key1], key;
    <span class="hljs-keyword">delete</span> index2[key2];</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Remove intermediary index layers if they are empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> index2) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">delete</span> index1[key1];
    <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> index1) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">delete</span> index0[key0];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="_findinindex-finds-a-set-of-quads-in-a-three-layered-index"><code>_findInIndex</code> finds a set of quads in a three-layered index.</h3>
<p>The index base is <code>index0</code> and the keys at each level are <code>key0</code>, <code>key1</code>, and <code>key2</code>.
Any of these keys can be undefined, which is interpreted as a wildcard.
<code>name0</code>, <code>name1</code>, and <code>name2</code> are the names of the keys at each level,
used when reconstructing the resulting quad
(for instance: <em>subject</em>, <em>predicate</em>, and <em>object</em>).
Finally, <code>graph</code> will be the graph of the created quads.
If <code>callback</code> is given, each result is passed through it
and iteration halts when it returns truthy for any quad.
If instead <code>array</code> is given, each result is added to the array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _findInIndex(index0, key0, key1, key2, name0, name1, name2, graph, callback, array) {
    <span class="hljs-keyword">var</span> tmp, index1, index2, varCount = !key0 + !key1 + !key2,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>depending on the number of variables, keys or reverse index are faster</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        entityKeys = varCount &gt; <span class="hljs-number">1</span> ? <span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">this</span>._ids) : <span class="hljs-built_in">this</span>._entities;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If a key is specified, use only that part of index 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (key0) (tmp = index0, index0 = {})[key0] = tmp[key0];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> value0 <span class="hljs-keyword">in</span> index0) {
      <span class="hljs-keyword">var</span> entity0 = entityKeys[value0];

      <span class="hljs-keyword">if</span> (index1 = index0[value0]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If a key is specified, use only that part of index 1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (key1) (tmp = index1, index1 = {})[key1] = tmp[key1];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> value1 <span class="hljs-keyword">in</span> index1) {
          <span class="hljs-keyword">var</span> entity1 = entityKeys[value1];

          <span class="hljs-keyword">if</span> (index2 = index1[value1]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>If a key is specified, use only that part of index 2, if it exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> values = key2 ? (key2 <span class="hljs-keyword">in</span> index2 ? [key2] : []) : <span class="hljs-built_in">Object</span>.keys(index2);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Create quads for all items found in index 2.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> l = <span class="hljs-number">0</span>; l &lt; values.length; l++) {
              <span class="hljs-keyword">var</span> parts = { <span class="hljs-attr">subject</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">predicate</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">object</span>: <span class="hljs-literal">null</span> };
              parts[name0] = termFromId(entity0, <span class="hljs-built_in">this</span>._factory);
              parts[name1] = termFromId(entity1, <span class="hljs-built_in">this</span>._factory);
              parts[name2] = termFromId(entityKeys[values[l]], <span class="hljs-built_in">this</span>._factory);
              <span class="hljs-keyword">var</span> quad = <span class="hljs-built_in">this</span>._factory.quad(
                parts.subject, parts.predicate, parts.object, termFromId(graph, <span class="hljs-built_in">this</span>._factory));
              <span class="hljs-keyword">if</span> (array)
                array.push(quad);
              <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (callback(quad))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
          }
        }
      }
    }
    <span class="hljs-keyword">return</span> array;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="_loop-executes-the-callback-on-all-keys-of-index-0"><code>_loop</code> executes the callback on all keys of index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _loop(index0, callback) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key0 <span class="hljs-keyword">in</span> index0)
      callback(key0);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3 id="_loopbykey0-executes-the-callback-on-all-keys-of-a-certain-entry-in-index-0"><code>_loopByKey0</code> executes the callback on all keys of a certain entry in index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _loopByKey0(index0, key0, callback) {
    <span class="hljs-keyword">var</span> index1, key1;
    <span class="hljs-keyword">if</span> (index1 = index0[key0]) {
      <span class="hljs-keyword">for</span> (key1 <span class="hljs-keyword">in</span> index1)
        callback(key1);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h3 id="_loopbykey1-executes-the-callback-on-given-keys-of-all-entries-in-index-0"><code>_loopByKey1</code> executes the callback on given keys of all entries in index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _loopByKey1(index0, key1, callback) {
    <span class="hljs-keyword">var</span> key0, index1;
    <span class="hljs-keyword">for</span> (key0 <span class="hljs-keyword">in</span> index0) {
      index1 = index0[key0];
      <span class="hljs-keyword">if</span> (index1[key1])
        callback(key0);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="_loopby2keys-executes-the-callback-on-given-keys-of-certain-entries-in-index-2"><code>_loopBy2Keys</code> executes the callback on given keys of certain entries in index 2</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _loopBy2Keys(index0, key0, key1, callback) {
    <span class="hljs-keyword">var</span> index1, index2, key2;
    <span class="hljs-keyword">if</span> ((index1 = index0[key0]) &amp;&amp; (index2 = index1[key1])) {
      <span class="hljs-keyword">for</span> (key2 <span class="hljs-keyword">in</span> index2)
        callback(key2);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="_countinindex-counts-matching-quads-in-a-three-layered-index"><code>_countInIndex</code> counts matching quads in a three-layered index.</h3>
<p>The index base is <code>index0</code> and the keys at each level are <code>key0</code>, <code>key1</code>, and <code>key2</code>.
Any of these keys can be undefined, which is interpreted as a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _countInIndex(index0, key0, key1, key2) {
    <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>, tmp, index1, index2;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If a key is specified, count only that part of index 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (key0) (tmp = index0, index0 = {})[key0] = tmp[key0];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> value0 <span class="hljs-keyword">in</span> index0) {
      <span class="hljs-keyword">if</span> (index1 = index0[value0]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If a key is specified, count only that part of index 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (key1) (tmp = index1, index1 = {})[key1] = tmp[key1];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> value1 <span class="hljs-keyword">in</span> index1) {
          <span class="hljs-keyword">if</span> (index2 = index1[value1]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>If a key is specified, count the quad if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (key2) (key2 <span class="hljs-keyword">in</span> index2) &amp;&amp; count++;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Otherwise, count all quads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> count += <span class="hljs-built_in">Object</span>.keys(index2).length;
          }
        }
      }
    }
    <span class="hljs-keyword">return</span> count;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3 id="_getgraphs-returns-an-array-with-the-given-graph"><code>_getGraphs</code> returns an array with the given graph,</h3>
<p>or all graphs if the argument is null or undefined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _getGraphs(graph) {
    <span class="hljs-keyword">if</span> (!isString(graph))
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._graphs;
    <span class="hljs-keyword">var</span> graphs = {};
    graphs[graph] = <span class="hljs-built_in">this</span>._graphs[graph];
    <span class="hljs-keyword">return</span> graphs;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h3 id="_uniqueentities-returns-a-function-that-accepts-an-entity-id"><code>_uniqueEntities</code> returns a function that accepts an entity ID</h3>
<p>and passes the corresponding entity to callback if it hasn’t occurred before.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _uniqueEntities(callback) {
    <span class="hljs-keyword">var</span> uniqueIds = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>), entities = <span class="hljs-built_in">this</span>._entities;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) </span>{
      <span class="hljs-keyword">if</span> (!(id <span class="hljs-keyword">in</span> uniqueIds)) {
        uniqueIds[id] = <span class="hljs-literal">true</span>;
        callback(termFromId(entities[id]));
      }
    };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="public-methods">Public methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3 id="addquad-adds-a-new-quad-to-the-store"><code>addQuad</code> adds a new quad to the store.</h3>
<p>Returns if the quad index has changed, if the quad did not already exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addQuad(subject, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Shift arguments if a quad object is given instead of components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!predicate)
      graph = subject.graph, object = subject.object,
        predicate = subject.predicate, subject = subject.subject;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = termToId(subject);
    predicate = termToId(predicate);
    object = termToId(object);
    graph = termToId(graph);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Find the graph that will contain the triple</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> graphItem = <span class="hljs-built_in">this</span>._graphs[graph];</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Create the graph if it doesn’t exist yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!graphItem) {
      graphItem = <span class="hljs-built_in">this</span>._graphs[graph] = { <span class="hljs-attr">subjects</span>: {}, <span class="hljs-attr">predicates</span>: {}, <span class="hljs-attr">objects</span>: {} };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Freezing a graph helps subsequent <code>add</code> performance,
and properties will never be modified anyway</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-built_in">Object</span>.freeze(graphItem);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Since entities can often be long IRIs, we avoid storing them in every index.
Instead, we have a separate index that maps entities to numbers,
which are then used as keys in the other indexes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> ids = <span class="hljs-built_in">this</span>._ids;
    <span class="hljs-keyword">var</span> entities = <span class="hljs-built_in">this</span>._entities;
    subject   = ids[subject]   || (ids[entities[++<span class="hljs-built_in">this</span>._id] = subject]   = <span class="hljs-built_in">this</span>._id);
    predicate = ids[predicate] || (ids[entities[++<span class="hljs-built_in">this</span>._id] = predicate] = <span class="hljs-built_in">this</span>._id);
    object    = ids[object]    || (ids[entities[++<span class="hljs-built_in">this</span>._id] = object]    = <span class="hljs-built_in">this</span>._id);

    <span class="hljs-keyword">var</span> changed = <span class="hljs-built_in">this</span>._addToIndex(graphItem.subjects,   subject,   predicate, object);
    <span class="hljs-built_in">this</span>._addToIndex(graphItem.predicates, predicate, object,    subject);
    <span class="hljs-built_in">this</span>._addToIndex(graphItem.objects,    object,    subject,   predicate);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>The cached quad count is now invalid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._size = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> changed;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h3 id="addquads-adds-multiple-quads-to-the-store"><code>addQuads</code> adds multiple quads to the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addQuads(quads) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; quads.length; i++)
      <span class="hljs-built_in">this</span>.addQuad(quads[i]);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h3 id="import-adds-a-stream-of-quads-to-the-store"><code>import</code> adds a stream of quads to the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">import</span>(stream) {
    <span class="hljs-keyword">var</span> self = <span class="hljs-built_in">this</span>;
    stream.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">quad</span>) </span>{ self.addQuad(quad); });
    <span class="hljs-keyword">return</span> stream;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h3 id="removequad-removes-a-quad-from-the-store-if-it-exists"><code>removeQuad</code> removes a quad from the store if it exists</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeQuad(subject, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Shift arguments if a quad object is given instead of components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!predicate)
      graph = subject.graph, object = subject.object,
        predicate = subject.predicate, subject = subject.subject;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = termToId(subject);
    predicate = termToId(predicate);
    object = termToId(object);
    graph = termToId(graph);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Find internal identifiers for all components
and verify the quad exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> graphItem, ids = <span class="hljs-built_in">this</span>._ids, graphs = <span class="hljs-built_in">this</span>._graphs, subjects, predicates;
    <span class="hljs-keyword">if</span> (!(subject    = ids[subject]) || !(predicate = ids[predicate]) ||
        !(object     = ids[object])  || !(graphItem = graphs[graph])  ||
        !(subjects   = graphItem.subjects[subject]) ||
        !(predicates = subjects[predicate]) ||
        !(object <span class="hljs-keyword">in</span> predicates))
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Remove it from all indexes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._removeFromIndex(graphItem.subjects,   subject,   predicate, object);
    <span class="hljs-built_in">this</span>._removeFromIndex(graphItem.predicates, predicate, object,    subject);
    <span class="hljs-built_in">this</span>._removeFromIndex(graphItem.objects,    object,    subject,   predicate);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._size !== <span class="hljs-literal">null</span>) <span class="hljs-built_in">this</span>._size--;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Remove the graph if it is empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (subject <span class="hljs-keyword">in</span> graphItem.subjects) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">delete</span> graphs[graph];
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h3 id="removequads-removes-multiple-quads-from-the-store"><code>removeQuads</code> removes multiple quads from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeQuads(quads) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; quads.length; i++)
      <span class="hljs-built_in">this</span>.removeQuad(quads[i]);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="remove-removes-a-stream-of-quads-from-the-store"><code>remove</code> removes a stream of quads from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  remove(stream) {
    <span class="hljs-keyword">var</span> self = <span class="hljs-built_in">this</span>;
    stream.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">quad</span>) </span>{ self.removeQuad(quad); });
    <span class="hljs-keyword">return</span> stream;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h3 id="removematches-removes-all-matching-quads-from-the-store"><code>removeMatches</code> removes all matching quads from the store</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  removeMatches(subject, predicate, object, graph) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.remove(<span class="hljs-built_in">this</span>.match(subject, predicate, object, graph));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h3 id="deletegraph-removes-all-triples-with-the-given-graph-from-the-store"><code>deleteGraph</code> removes all triples with the given graph from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  deleteGraph(graph) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.removeMatches(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, graph);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h3 id="getquads-returns-an-array-of-quads-matching-a-pattern"><code>getQuads</code> returns an array of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getQuads(subject, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = subject &amp;&amp; termToId(subject);
    predicate = predicate &amp;&amp; termToId(predicate);
    object = object &amp;&amp; termToId(object);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> quads = [], graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content,
        ids = <span class="hljs-built_in">this</span>._ids, subjectId, predicateId, objectId;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(subject)   &amp;&amp; !(subjectId   = ids[subject])   ||
        isString(predicate) &amp;&amp; !(predicateId = ids[predicate]) ||
        isString(object)    &amp;&amp; !(objectId    = ids[object]))
      <span class="hljs-keyword">return</span> quads;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> graphId <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graphId]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Choose the optimal index, based on what fields are present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>If subject and object are given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._findInIndex(content.objects, objectId, subjectId, predicateId,
                              <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId, <span class="hljs-literal">null</span>, quads);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>If only subject and possibly predicate are given, the subject index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._findInIndex(content.subjects, subjectId, predicateId, <span class="hljs-literal">null</span>,
                              <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId, <span class="hljs-literal">null</span>, quads);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>If only predicate and possibly object are given, the predicate index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._findInIndex(content.predicates, predicateId, objectId, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, graphId, <span class="hljs-literal">null</span>, quads);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>If only object is given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._findInIndex(content.objects, objectId, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId, <span class="hljs-literal">null</span>, quads);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>If nothing is given, iterate subjects and predicates first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._findInIndex(content.subjects, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId, <span class="hljs-literal">null</span>, quads);
      }
    }
    <span class="hljs-keyword">return</span> quads;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h3 id="match-returns-a-stream-of-quads-matching-a-pattern"><code>match</code> returns a stream of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  match(subject, predicate, object, graph) {
    <span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">new</span> Readable({ <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Initialize stream once it is being read</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    stream._read = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> quad <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.getQuads(subject, predicate, object, graph))
        stream.push(quad);
      stream.push(<span class="hljs-literal">null</span>);
    };

    <span class="hljs-keyword">return</span> stream;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <h3 id="countquads-returns-the-number-of-quads-matching-a-pattern"><code>countQuads</code> returns the number of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  countQuads(subject, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = subject &amp;&amp; termToId(subject);
    predicate = predicate &amp;&amp; termToId(predicate);
    object = object &amp;&amp; termToId(object);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>, graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content,
        ids = <span class="hljs-built_in">this</span>._ids, subjectId, predicateId, objectId;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(subject)   &amp;&amp; !(subjectId   = ids[subject])   ||
        isString(predicate) &amp;&amp; !(predicateId = ids[predicate]) ||
        isString(object)    &amp;&amp; !(objectId    = ids[object]))
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> graphId <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graphId]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Choose the optimal index, based on what fields are present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subject) {
          <span class="hljs-keyword">if</span> (object)</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>If subject and object are given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            count += <span class="hljs-built_in">this</span>._countInIndex(content.objects, objectId, subjectId, predicateId);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>If only subject and possibly predicate are given, the subject index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            count += <span class="hljs-built_in">this</span>._countInIndex(content.subjects, subjectId, predicateId, objectId);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicate) {</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>If only predicate and possibly object are given, the predicate index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          count += <span class="hljs-built_in">this</span>._countInIndex(content.predicates, predicateId, objectId, subjectId);
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>If only object is possibly given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          count += <span class="hljs-built_in">this</span>._countInIndex(content.objects, objectId, subjectId, predicateId);
        }
      }
    }
    <span class="hljs-keyword">return</span> count;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <h3 id="foreach-executes-the-callback-on-all-quads"><code>forEach</code> executes the callback on all quads.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forEach(callback, subject, predicate, object, graph) {
    <span class="hljs-built_in">this</span>.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">quad</span>) </span>{
      callback(quad);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }, subject, predicate, object, graph);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <h3 id="every-executes-the-callback-on-all-quads"><code>every</code> executes the callback on all quads,</h3>
<p>and returns <code>true</code> if it returns truthy for all them.
Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  every(callback, subject, predicate, object, graph) {
    <span class="hljs-keyword">var</span> some = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> every = !<span class="hljs-built_in">this</span>.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">quad</span>) </span>{
      some = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> !callback(quad);
    }, subject, predicate, object, graph);
    <span class="hljs-keyword">return</span> some &amp;&amp; every;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <h3 id="some-executes-the-callback-on-all-quads"><code>some</code> executes the callback on all quads,</h3>
<p>and returns <code>true</code> if it returns truthy for any of them.
Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  some(callback, subject, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = subject &amp;&amp; termToId(subject);
    predicate = predicate &amp;&amp; termToId(predicate);
    object = object &amp;&amp; termToId(object);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content,
        ids = <span class="hljs-built_in">this</span>._ids, subjectId, predicateId, objectId;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(subject)   &amp;&amp; !(subjectId   = ids[subject])   ||
        isString(predicate) &amp;&amp; !(predicateId = ids[predicate]) ||
        isString(object)    &amp;&amp; !(objectId    = ids[object]))
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> graphId <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graphId]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Choose the optimal index, based on what fields are present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (objectId) {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>If subject and object are given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._findInIndex(content.objects, objectId, subjectId, predicateId,
                                  <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId, callback, <span class="hljs-literal">null</span>))
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>If only subject and possibly predicate are given, the subject index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._findInIndex(content.subjects, subjectId, predicateId, <span class="hljs-literal">null</span>,
                                  <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId, callback, <span class="hljs-literal">null</span>))
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicateId) {</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>If only predicate and possibly object are given, the predicate index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._findInIndex(content.predicates, predicateId, objectId, <span class="hljs-literal">null</span>,
                                <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, graphId, callback, <span class="hljs-literal">null</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId) {</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>If only object is given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._findInIndex(content.objects, objectId, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                                <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId, callback, <span class="hljs-literal">null</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }
        }
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>If nothing is given, iterate subjects and predicates first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._findInIndex(content.subjects, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                              <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId, callback, <span class="hljs-literal">null</span>)) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <h3 id="getsubjects-returns-all-subjects-that-match-the-pattern"><code>getSubjects</code> returns all subjects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getSubjects(predicate, object, graph) {
    <span class="hljs-keyword">var</span> results = [];
    <span class="hljs-built_in">this</span>.forSubjects(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) </span>{ results.push(s); }, predicate, object, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <h3 id="forsubjects-executes-the-callback-on-all-subjects-that-match-the-pattern"><code>forSubjects</code> executes the callback on all subjects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forSubjects(callback, predicate, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    predicate = predicate &amp;&amp; termToId(predicate);
    object = object &amp;&amp; termToId(object);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> ids = <span class="hljs-built_in">this</span>._ids, graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content, predicateId, objectId;
    callback = <span class="hljs-built_in">this</span>._uniqueEntities(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(predicate) &amp;&amp; !(predicateId = ids[predicate]) ||
        isString(object)    &amp;&amp; !(objectId    = ids[object]))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (predicateId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>If predicate and object are given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopBy2Keys(content.predicates, predicateId, objectId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>If only predicate is given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopByKey1(content.subjects, predicateId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>If only object is given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loopByKey0(content.objects, objectId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>If no params given, iterate all the subjects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loop(content.subjects, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <h3 id="getpredicates-returns-all-predicates-that-match-the-pattern"><code>getPredicates</code> returns all predicates that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getPredicates(subject, object, graph) {
    <span class="hljs-keyword">var</span> results = [];
    <span class="hljs-built_in">this</span>.forPredicates(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>{ results.push(p); }, subject, object, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <h3 id="forpredicates-executes-the-callback-on-all-predicates-that-match-the-pattern"><code>forPredicates</code> executes the callback on all predicates that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forPredicates(callback, subject, object, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = subject &amp;&amp; termToId(subject);
    object = object &amp;&amp; termToId(object);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> ids = <span class="hljs-built_in">this</span>._ids, graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content, subjectId, objectId;
    callback = <span class="hljs-built_in">this</span>._uniqueEntities(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(subject) &amp;&amp; !(subjectId = ids[subject]) ||
        isString(object)  &amp;&amp; !(objectId  = ids[object]))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>If subject and object are given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopBy2Keys(content.objects, objectId, subjectId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>If only subject is given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopByKey0(content.subjects, subjectId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>If only object is given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loopByKey1(content.predicates, objectId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>If no params given, iterate all the predicates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loop(content.predicates, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <h3 id="getobjects-returns-all-objects-that-match-the-pattern"><code>getObjects</code> returns all objects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getObjects(subject, predicate, graph) {
    <span class="hljs-keyword">var</span> results = [];
    <span class="hljs-built_in">this</span>.forObjects(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{ results.push(o); }, subject, predicate, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <h3 id="forobjects-executes-the-callback-on-all-objects-that-match-the-pattern"><code>forObjects</code> executes the callback on all objects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forObjects(callback, subject, predicate, graph) {</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject = subject &amp;&amp; termToId(subject);
    predicate = predicate &amp;&amp; termToId(predicate);
    graph = graph &amp;&amp; termToId(graph);

    <span class="hljs-keyword">var</span> ids = <span class="hljs-built_in">this</span>._ids, graphs = <span class="hljs-built_in">this</span>._getGraphs(graph), content, subjectId, predicateId;
    callback = <span class="hljs-built_in">this</span>._uniqueEntities(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isString(subject)   &amp;&amp; !(subjectId   = ids[subject]) ||
        isString(predicate) &amp;&amp; !(predicateId = ids[predicate]))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>If subject and predicate are given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopBy2Keys(content.subjects, subjectId, predicateId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>If only subject is given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>._loopByKey1(content.objects, subjectId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>If only predicate is given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loopByKey0(content.predicates, predicateId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>If no params given, iterate all the objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-built_in">this</span>._loop(content.objects, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <h3 id="getgraphs-returns-all-graphs-that-match-the-pattern"><code>getGraphs</code> returns all graphs that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getGraphs(subject, predicate, object) {
    <span class="hljs-keyword">var</span> results = [];
    <span class="hljs-built_in">this</span>.forGraphs(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">g</span>) </span>{ results.push(g); }, subject, predicate, object);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <h3 id="forgraphs-executes-the-callback-on-all-graphs-that-match-the-pattern"><code>forGraphs</code> executes the callback on all graphs that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  forGraphs(callback, subject, predicate, object) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> graph <span class="hljs-keyword">in</span> <span class="hljs-built_in">this</span>._graphs) {
      <span class="hljs-built_in">this</span>.some(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">quad</span>) </span>{
        callback(quad.graph);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// Halt iteration of some()</span>
      }, subject, predicate, object, graph);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <h3 id="createblanknode-creates-a-new-blank-node-returning-its-name"><code>createBlankNode</code> creates a new blank node, returning its name</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createBlankNode(suggestedName) {
    <span class="hljs-keyword">var</span> name, index;</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Generate a name based on the suggested name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (suggestedName) {
      name = suggestedName = <span class="hljs-string">&#x27;_:&#x27;</span> + suggestedName, index = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>._ids[name])
        name = suggestedName + index++;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Generate a generic blank node name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">do</span> { name = <span class="hljs-string">&#x27;_:b&#x27;</span> + <span class="hljs-built_in">this</span>._blankNodeIndex++; }
      <span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>._ids[name]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Add the blank node to the entities, avoiding the generation of duplicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._ids[name] = ++<span class="hljs-built_in">this</span>._id;
    <span class="hljs-built_in">this</span>._entities[<span class="hljs-built_in">this</span>._id] = name;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._factory.blankNode(name.substr(<span class="hljs-number">2</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <h3 id="extractlists-finds-and-removes-all-list-triples"><code>extractLists</code> finds and removes all list triples</h3>
<p>and returns the items per list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  extractLists({ remove = <span class="hljs-literal">false</span>, ignoreErrors = <span class="hljs-literal">false</span> } = {}) {
    <span class="hljs-keyword">var</span> lists = {}; <span class="hljs-comment">// has scalar keys so could be a simple Object</span>
    <span class="hljs-keyword">var</span> onError = ignoreErrors ? (<span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>) :
                  (<span class="hljs-function">(<span class="hljs-params">node, message</span>) =&gt;</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${node.value}</span> <span class="hljs-subst">${message}</span>`</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Traverse each list from its tail</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> tails = <span class="hljs-built_in">this</span>.getQuads(<span class="hljs-literal">null</span>, namespaces.rdf.rest, namespaces.rdf.nil, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">var</span> toRemove = remove ? [...tails] : [];
    tails.forEach(<span class="hljs-function"><span class="hljs-params">tailQuad</span> =&gt;</span> {
      <span class="hljs-keyword">var</span> items = [];             <span class="hljs-comment">// the members found as objects of rdf:first quads</span>
      <span class="hljs-keyword">var</span> malformed = <span class="hljs-literal">false</span>;      <span class="hljs-comment">// signals whether the current list is malformed</span>
      <span class="hljs-keyword">var</span> head;                   <span class="hljs-comment">// the head of the list (_:b1 in above example)</span>
      <span class="hljs-keyword">var</span> headPos;                <span class="hljs-comment">// set to subject or object when head is set</span>
      <span class="hljs-keyword">var</span> graph = tailQuad.graph; <span class="hljs-comment">// make sure list is in exactly one graph</span></pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Traverse the list from tail to end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> current = tailQuad.subject;
      <span class="hljs-keyword">while</span> (current &amp;&amp; !malformed) {
        <span class="hljs-keyword">var</span> objectQuads = <span class="hljs-built_in">this</span>.getQuads(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, current, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">var</span> subjectQuads = <span class="hljs-built_in">this</span>.getQuads(current, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">var</span> i, quad, first = <span class="hljs-literal">null</span>, rest = <span class="hljs-literal">null</span>, parent = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Find the first and rest of this list node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; subjectQuads.length &amp;&amp; !malformed; i++) {
          quad = subjectQuads[i];
          <span class="hljs-keyword">if</span> (!quad.graph.equals(graph))
            malformed = onError(current, <span class="hljs-string">&#x27;not confined to single graph&#x27;</span>);
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (head)
            malformed = onError(current, <span class="hljs-string">&#x27;has non-list arcs out&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>one rdf:first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.predicate.value === namespaces.rdf.first) {
            <span class="hljs-keyword">if</span> (first)
              malformed = onError(current, <span class="hljs-string">&#x27;has multiple rdf:first arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              toRemove.push(first = quad);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>one rdf:rest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.predicate.value === namespaces.rdf.rest) {
            <span class="hljs-keyword">if</span> (rest)
              malformed = onError(current, <span class="hljs-string">&#x27;has multiple rdf:rest arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              toRemove.push(rest = quad);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>alien triple</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectQuads.length)
            malformed = onError(current, <span class="hljs-string">&#x27;can\&#x27;t be subject and object&#x27;</span>);
          <span class="hljs-keyword">else</span> {
            head = quad; <span class="hljs-comment">// e.g. { (1 2 3) :p :o }</span>
            headPos = <span class="hljs-string">&#x27;subject&#x27;</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>{ :s :p (1 2) } arrives here with no head
{ (1 2) :p :o } arrives here with head set to the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; objectQuads.length &amp;&amp; !malformed; ++i) {
          quad = objectQuads[i];
          <span class="hljs-keyword">if</span> (head)
            malformed = onError(current, <span class="hljs-string">&#x27;can\&#x27;t have coreferences&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>one rdf:rest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.predicate.value === namespaces.rdf.rest) {
            <span class="hljs-keyword">if</span> (parent)
              malformed = onError(current, <span class="hljs-string">&#x27;has incoming rdf:rest arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              parent = quad;
          }
          <span class="hljs-keyword">else</span> {
            head = quad; <span class="hljs-comment">// e.g. { :s :p (1 2) }</span>
            headPos = <span class="hljs-string">&#x27;object&#x27;</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Store the list item and continue with parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!first)
          malformed = onError(current, <span class="hljs-string">&#x27;has no list head&#x27;</span>);
        <span class="hljs-keyword">else</span>
          items.unshift(first.object);
        current = parent &amp;&amp; parent.subject;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Don’t remove any quads if the list is malformed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (malformed)
        remove = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Store the list under the value of its head</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (head)
        lists[head[headPos].value] = items;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Remove list quads if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (remove)
      <span class="hljs-built_in">this</span>.removeQuads(toRemove);
    <span class="hljs-keyword">return</span> lists;
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Determines whether the argument is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isString</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> s === <span class="hljs-string">&#x27;string&#x27;</span> || s <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">String</span>;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
